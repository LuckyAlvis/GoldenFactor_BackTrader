# 中国建筑月级波段交易策略 - 完整项目

## 📋 项目概述

本项目实现了针对中国建筑（601668.SH）的月级波段交易策略，基于MACD、移动平均线、RSI和成交量等技术指标，使用backtrader框架进行回测。

## 📁 文件结构

```
backtrader/
├── monthly_swing_strategy.py      # 原始策略（严格版，3/3条件）
├── monthly_swing_optimized.py     # 优化策略（灵活版，2/3条件）✅ 推荐
├── 月级波段策略说明.md             # 详细策略文档和优化建议
├── 中国建筑策略回测报告.md         # 完整回测结果分析报告
├── README_月级策略.md             # 本文件
└── sh601668.csv                   # 中国建筑历史数据
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip3 install -r requirements.txt
```

依赖包：
- backtrader==1.9.78.123
- pandas==2.0.3
- matplotlib==3.7.2
- numpy==1.24.3

### 2. 运行回测

**推荐：运行优化版策略**
```bash
python3 monthly_swing_optimized.py
```

**或运行原始版策略**
```bash
python3 monthly_swing_strategy.py
```

### 3. 查看结果

回测完成后会显示：
- 📊 回测结果（收益率、夏普比率、最大回撤）
- 📝 交易统计（交易次数、胜率、盈亏）
- 📈 可视化图表（K线图+指标+交易信号）

## 📊 策略说明

### 核心逻辑

**入场信号**（优化版：满足2/3条件）：
1. 月线MACD金叉（快线突破慢线）
2. 收盘价站稳月线MA60
3. 成交量较前3月均值放大20%以上

**出场信号**（满足任一条件）：
1. MACD死叉 + RSI超买(>70)
2. 从波段高点回撤5%（动态止盈）
3. 达到15%固定止盈

**止损规则**（满足任一条件）：
1. 跌破入场价8%
2. 跌破月线MA120

**仓位管理**：
- 首次建仓：30%
- 回调3%加仓：20%
- 最大仓位：50%

### 回测配置

- 初始资金：1,000,000元
- 佣金：万2.5（0.00025）
- 滑点：0.1%
- 数据周期：月线（日线重采样）
- 回测期间：2009年7月 - 2025年1月

## 📈 回测结果

### 优化版策略（推荐）

| 指标 | 数值 |
|------|------|
| 初始资金 | 1,000,000.00元 |
| 期末资金 | 907,401.55元 |
| 总收益 | -92,598.45元 |
| 收益率 | -9.26% |
| 夏普比率 | -0.23 |
| 最大回撤 | 9.26% |
| 交易次数 | 4次 |
| 胜率 | 25% |

### 原始版策略

| 指标 | 数值 |
|------|------|
| 交易次数 | 0次 |
| 原因 | 入场条件过于严格 |

## 🔍 交易记录

### 交易1：2022年4月-6月 ❌
- 入场：6.30元
- 出场：5.49元
- 结果：亏损38,385.99元（-12.49%）
- 原因：固定止损

### 交易2：2022年11月-2023年1月 ❌
- 入场：5.90元
- 出场：5.43元
- 结果：亏损22,743.97元（-7.90%）
- 原因：跌破MA120

### 交易3：2023年3月-6月 ✅
- 入场：5.80元
- 出场：5.88元
- 结果：盈利4,141.90元（+1.38%）
- 原因：动态止盈

### 交易4：2024年9月-11月 ❌
- 入场：6.79元（滑点严重）
- 出场：6.01元
- 结果：亏损35,610.40元（-11.34%）
- 原因：固定止损

## ⚠️ 问题诊断

### 主要问题

1. **胜率过低**：仅25%（1盈3亏）
2. **滑点影响**：交易4滑点达9.87%
3. **趋势判断**：多次在下跌趋势中入场
4. **止损频繁**：3笔交易触发止损

### 改进方向

1. **增加趋势过滤**：要求均线多头排列
2. **优化止损**：使用ATR动态止损
3. **控制滑点**：使用限价单，分批建仓
4. **环境过滤**：加入大盘指数过滤

## 🛠️ 参数优化

### 可调参数

```python
params = (
    ('macd_fast', 12),           # MACD快线周期
    ('macd_slow', 26),           # MACD慢线周期
    ('ma_short', 60),            # 短期均线
    ('ma_long', 120),            # 长期均线
    ('volume_threshold', 1.2),   # 成交量阈值
    ('stop_loss_pct', 0.08),     # 固定止损
    ('take_profit_pct', 0.15),   # 固定止盈
    ('trailing_stop_pct', 0.05), # 动态止盈
    ('initial_position', 0.30),  # 首次建仓
    ('entry_mode', 'flexible'),  # 入场模式
    ('min_conditions', 2),       # 最少满足条件数
)
```

### 参数优化代码

在`run_backtest()`函数中添加：

```python
# 替换 cerebro.addstrategy(MonthlySwingOptimized)
cerebro.optstrategy(
    MonthlySwingOptimized,
    macd_fast=range(8, 17, 2),
    macd_slow=range(20, 36, 5),
    volume_threshold=[1.1, 1.2, 1.3, 1.4, 1.5],
    stop_loss_pct=[0.08, 0.10, 0.12]
)
```

## 📚 文档说明

### 1. 月级波段策略说明.md

包含：
- 策略详细逻辑
- 参数优化建议
- 多因子增强方案
- 风险控制措施
- 实盘建议

### 2. 中国建筑策略回测报告.md

包含：
- 策略版本对比
- 交易记录详细分析
- 问题诊断
- 优化建议
- 改进版策略方案
- 参数优化方法

## 💡 优化建议

### 入场条件优化

**方案1：严格版（保守）**
```python
# 4个条件全部满足
- MACD金叉且DIF>0
- 价格同时站稳MA60和MA120
- MA60 > MA120（均线多头排列）
- 成交量放大30%以上
```

**方案2：趋势跟踪版（推荐）**
```python
# 强趋势确认
- 价格突破MA60且MA60向上
- MACD>0（在零轴上方）
- 成交量放大20%以上
- ADX>25（趋势强度确认）
```

### 止损优化

**动态止损方案**：
```python
# 基于ATR的动态止损
stop_distance = 2.5 * ATR
stop_price = entry_price - stop_distance

# 限制范围：8%-15%
min_stop = entry_price * 0.92
max_stop = entry_price * 0.85
```

### 仓位管理优化

**分级建仓**：
```python
# 首次：20%试探
# 确认趋势：加仓15%（总35%）
# 盈利5%：再加仓15%（总50%）
```

## 🎯 使用场景

### 适合

- ✅ 长期投资者（持仓周期1-3个月）
- ✅ 趋势跟踪策略
- ✅ 低频交易（年交易次数<10次）
- ✅ 学习量化交易

### 不适合

- ❌ 短线交易（日内/周级）
- ❌ 高频交易
- ❌ 震荡市场
- ❌ 直接实盘（需优化）

## ⚠️ 风险提示

1. **历史回测不代表未来**：过去收益不保证未来收益
2. **当前策略为负收益**：-9.26%，不建议直接实盘
3. **样本量不足**：仅4笔交易，统计意义有限
4. **市场环境变化**：策略在不同市场表现差异大
5. **滑点风险**：月线策略可能面临较大滑点

## 🔧 技术支持

### 依赖库文档

- Backtrader: https://www.backtrader.com/docu/
- Pandas: https://pandas.pydata.org/docs/
- Matplotlib: https://matplotlib.org/stable/contents.html

### 学习资源

- 量化交易社区：https://www.joinquant.com/
- 技术指标详解：https://www.investopedia.com/
- Python量化：https://www.quantstart.com/

## 📝 更新日志

### v1.0 (2025-01)
- ✅ 实现原始策略（严格版）
- ✅ 实现优化策略（灵活版）
- ✅ 完成回测分析
- ✅ 编写详细文档
- ✅ 提供优化建议

### 待开发功能
- ⏳ 参数自动优化
- ⏳ 多股票组合回测
- ⏳ 大盘环境过滤
- ⏳ 机器学习增强
- ⏳ 实时信号监控

## 📧 联系方式

如有问题或建议，欢迎通过以下方式联系：
- 提交Issue
- 发送邮件
- 参与讨论

## 📄 许可证

本项目仅供学习研究使用，不构成投资建议。

---

**最后更新**：2025年1月  
**策略版本**：v1.0  
**回测引擎**：Backtrader 1.9.78.123

**免责声明**：投资有风险，入市需谨慎。本策略仅供学习参考，不构成任何投资建议。
