# 中国建筑（601668.SH）月级波段交易策略回测报告

## 执行摘要

本报告详细记录了针对中国建筑（601668.SH）的月级波段交易策略的回测结果，包括原始版本和优化版本的对比分析。

---

## 一、策略版本对比

### 1.1 原始版本（monthly_swing_strategy.py）

**入场条件**：三个条件必须同时满足
- ✅ MACD金叉
- ✅ 收盘价站稳MA60
- ✅ 成交量放大30%以上

**回测结果**：
- 交易次数：0次
- 原因：条件过于严格，无交易机会

### 1.2 优化版本（monthly_swing_optimized.py）

**优化措施**：
1. 降低成交量阈值：30% → 20%
2. 入场模式：满足2/3条件即可
3. 增加详细的信号日志

**回测结果**：
- 初始资金：1,000,000元
- 期末资金：907,401.55元
- 总收益：-92,598.45元
- 收益率：-9.26%
- 夏普比率：-0.23
- 最大回撤：9.26%
- 交易次数：4次
- 胜率：25%（1盈3亏）

---

## 二、交易记录详细分析

### 交易1：2022年4月-6月（亏损）

**入场**：
- 日期：2022-04-30
- 价格：6.30元
- 数量：47,700股
- 满足条件：价格>MA60 ✅ + 成交量放大 ✅

**出场**：
- 日期：2022-06-30
- 价格：5.49元
- 原因：触发固定止损（亏损12.49%）
- 净利润：-38,385.99元

**分析**：
- 入场时MACD未金叉，趋势判断不准确
- 市场处于下跌趋势，止损及时避免更大损失

### 交易2：2022年11月-2023年1月（亏损）

**入场**：
- 日期：2022-11-30
- 价格：5.90元
- 数量：49,000股
- 满足条件：价格>MA60 ✅ + 成交量放大46% ✅

**出场**：
- 日期：2023-01-31
- 价格：5.43元
- 原因：跌破MA120止损
- 净利润：-22,743.97元

**分析**：
- 成交量放大显著（146%），但MACD未金叉
- 价格快速跌破长期均线，止损机制有效

### 交易3：2023年3月-6月（盈利）✅

**入场**：
- 日期：2023-03-31
- 价格：5.80元
- 数量：48,500股
- 满足条件：价格>MA60 ✅ + 成交量放大60% ✅

**出场**：
- 日期：2023-06-30
- 价格：5.88元
- 原因：动态止盈（从最高点6.57回撤10.20%）
- 净利润：+4,141.90元

**分析**：
- 唯一盈利的交易
- 最高涨幅13.36%，动态止盈保护了大部分利润
- 成交量放大显著（160%），显示市场活跃

### 交易4：2024年9月-11月（亏损）

**入场**：
- 日期：2024-09-30
- 价格：6.79元（实际执行价）
- 数量：45,700股
- 满足条件：MACD金叉 ✅ + 价格>MA60 ✅

**出场**：
- 日期：2024-11-30
- 价格：6.01元
- 原因：触发固定止损（亏损11.34%）
- 净利润：-35,610.40元

**分析**：
- 入场价格出现滑点（信号价6.18，执行价6.79）
- 滑点达9.87%，严重影响交易结果
- 需要优化订单执行机制

---

## 三、策略问题诊断

### 3.1 主要问题

1. **胜率过低（25%）**
   - 4笔交易中3笔亏损
   - 平均亏损远大于平均盈利

2. **滑点影响严重**
   - 交易4的滑点达9.87%
   - 月线策略在月初执行可能面临较大滑点

3. **止损触发频繁**
   - 3笔亏损交易都触发了止损
   - 8%的固定止损可能过于激进

4. **趋势判断不准**
   - 多次在下跌趋势中入场
   - 缺乏大盘环境过滤

### 3.2 信号质量分析

| 交易 | MACD金叉 | 价格>MA60 | 成交量放大 | 结果 |
|------|----------|-----------|------------|------|
| 1 | ❌ | ✅ | ✅ (124%) | 亏损 |
| 2 | ❌ | ✅ | ✅ (146%) | 亏损 |
| 3 | ❌ | ✅ | ✅ (160%) | 盈利 |
| 4 | ✅ | ✅ | ❌ (115%) | 亏损 |

**发现**：
- MACD金叉不是盈利的必要条件
- 成交量放大幅度越大，效果越好（交易3）
- 需要更强的趋势确认机制

---

## 四、优化建议

### 4.1 入场条件优化

**方案1：增加趋势过滤**
```python
# 要求价格同时站稳MA60和MA120
price_above_mas = (
    self.dataclose[0] > self.ma60[0] and 
    self.dataclose[0] > self.ma120[0]
)

# 要求均线多头排列
ma_bullish = self.ma60[0] > self.ma120[0]
```

**方案2：增加MACD强度过滤**
```python
# 要求MACD金叉且DIF为正
macd_strong = (
    self.macd_crossover[0] > 0 and 
    self.macd_line[0] > 0
)
```

**方案3：增加大盘环境过滤**
```python
# 只在上证指数月线向上时交易
# 需要加载上证指数数据
market_bullish = index_close[0] > index_ma20[0]
```

### 4.2 止损优化

**动态止损方案**：
```python
# 基于ATR的动态止损
self.atr = bt.indicators.ATR(self.datas[0], period=14)

def calculate_stop_loss(self):
    # 止损距离 = 2.5倍ATR
    atr_value = self.atr[0]
    stop_distance = 2.5 * atr_value
    stop_price = self.entry_price - stop_distance
    
    # 最小止损8%，最大止损15%
    min_stop = self.entry_price * 0.92
    max_stop = self.entry_price * 0.85
    
    return max(min_stop, min(max_stop, stop_price))
```

### 4.3 滑点控制

**建议措施**：
1. 使用限价单而非市价单
2. 在月线收盘前1-2天提前布局
3. 分批建仓降低冲击成本
4. 避免在成交量过低时交易

### 4.4 仓位管理优化

**分级建仓方案**：
```python
# 第一次：20%仓位试探
# 确认趋势后：加仓15%（总35%）
# 盈利5%后：再加仓15%（总50%）

def dynamic_position_sizing(self):
    if not self.position:
        return 0.20  # 首次20%
    
    profit = (self.dataclose[0] - self.entry_price) / self.entry_price
    
    if profit > 0.05 and self.current_position < 0.50:
        return 0.15  # 盈利后加仓
    elif profit > 0 and self.current_position < 0.35:
        return 0.15  # 确认趋势后加仓
    
    return 0
```

---

## 五、改进版策略建议

### 5.1 严格版策略（保守型）

**入场条件（4/4必须满足）**：
1. MACD金叉且DIF>0
2. 价格同时站稳MA60和MA120
3. MA60 > MA120（均线多头排列）
4. 成交量放大30%以上

**止损**：
- 固定止损：10%
- 均线止损：跌破MA120

**止盈**：
- 固定止盈：20%
- 动态止盈：从最高点回撤8%

### 5.2 灵活版策略（激进型）

**入场条件（满足以下任一组合）**：
- 组合A：MACD金叉 + 价格>MA60 + 成交量放大
- 组合B：价格>MA60 + MA60>MA120 + 成交量放大50%以上
- 组合C：MACD金叉 + 价格>MA120 + RSI(30-50)

**止损**：
- 动态止损：2.5倍ATR
- 最大止损：12%

**止盈**：
- 分级止盈：5%/10%/15%
- 动态止盈：从最高点回撤5%

### 5.3 趋势跟踪版（推荐）

**核心思路**：只在明确的上升趋势中交易

**入场条件**：
1. 价格突破MA60且MA60向上
2. MACD>0（在零轴上方）
3. 成交量放大20%以上
4. ADX>25（趋势强度确认）

**持仓管理**：
- 首次建仓：25%
- 盈利3%加仓：15%
- 盈利8%加仓：10%
- 最大仓位：50%

**出场条件**：
- 价格跌破MA60
- MACD死叉
- 从最高点回撤6%

---

## 六、参数优化建议

### 6.1 需要优化的参数

| 参数 | 当前值 | 建议范围 | 优化方法 |
|------|--------|----------|----------|
| MACD快线 | 12 | 8-16 | 网格搜索 |
| MACD慢线 | 26 | 17-35 | 网格搜索 |
| MA短期 | 60 | 40-80 | 步进搜索 |
| MA长期 | 120 | 100-150 | 步进搜索 |
| 成交量阈值 | 1.2 | 1.1-1.5 | 步进搜索 |
| 固定止损 | 8% | 8%-15% | 步进搜索 |
| 固定止盈 | 15% | 12%-25% | 步进搜索 |

### 6.2 参数优化代码

```python
# 在run_backtest()中使用
cerebro.optstrategy(
    MonthlySwingOptimized,
    macd_fast=range(8, 17, 2),          # 8, 10, 12, 14, 16
    macd_slow=range(20, 36, 5),         # 20, 25, 30, 35
    volume_threshold=[1.1, 1.2, 1.3, 1.4, 1.5],
    stop_loss_pct=[0.08, 0.10, 0.12],
    take_profit_pct=[0.12, 0.15, 0.18, 0.20]
)

# 运行优化
results = cerebro.run()

# 找出最优参数
best_result = None
best_value = 0

for result in results:
    strat = result[0]
    final_value = strat.broker.getvalue()
    
    if final_value > best_value:
        best_value = final_value
        best_result = strat

print(f'最优参数组合:')
print(f'MACD: ({best_result.params.macd_fast}, {best_result.params.macd_slow})')
print(f'成交量阈值: {best_result.params.volume_threshold}')
print(f'止损: {best_result.params.stop_loss_pct*100}%')
print(f'止盈: {best_result.params.take_profit_pct*100}%')
print(f'最终资金: {best_value:,.2f}')
```

---

## 七、实盘建议

### 7.1 不建议直接实盘的原因

1. **负收益**：回测收益率-9.26%
2. **低胜率**：仅25%的胜率
3. **样本不足**：仅4笔交易，统计意义不足
4. **市场环境**：未考虑大盘和行业因素

### 7.2 如果要实盘，必须满足

1. **完成参数优化**：找到正收益的参数组合
2. **扩大样本**：在更多股票上测试
3. **前向测试**：在最近1年数据上验证
4. **纸上交易**：先进行3-6个月模拟盘
5. **小资金试错**：初始资金不超过总资金的10%

### 7.3 风险控制措施

1. **账户级止损**：总资金回撤超过15%暂停交易
2. **单笔限额**：单笔亏损不超过总资金的3%
3. **持仓限制**：单只股票仓位不超过50%
4. **定期评估**：每月评估策略表现
5. **应急预案**：准备好极端行情的应对方案

---

## 八、结论

### 8.1 策略评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 收益性 | ⭐ | -9.26%，不达标 |
| 稳定性 | ⭐⭐ | 胜率25%，波动大 |
| 风险控制 | ⭐⭐⭐ | 止损机制有效 |
| 可操作性 | ⭐⭐⭐⭐ | 月线策略，操作简单 |
| 可优化性 | ⭐⭐⭐⭐ | 优化空间大 |

**综合评分**：2.6/5.0（需要大幅优化）

### 8.2 核心发现

1. **月线策略适合长期趋势**：但需要更强的趋势确认
2. **成交量是重要信号**：放大幅度越大效果越好
3. **滑点影响显著**：需要优化订单执行
4. **止损保护有效**：避免了更大损失
5. **需要环境过滤**：大盘和行业因素很重要

### 8.3 下一步工作

1. **参数优化**：使用网格搜索找最优参数
2. **增加过滤**：加入大盘和行业过滤
3. **改进信号**：测试其他技术指标组合
4. **扩大测试**：在更多股票上验证
5. **前向验证**：在最新数据上测试

---

## 附录

### A. 代码文件清单

1. `monthly_swing_strategy.py` - 原始策略（严格版）
2. `monthly_swing_optimized.py` - 优化策略（灵活版）
3. `月级波段策略说明.md` - 详细策略文档
4. `中国建筑策略回测报告.md` - 本报告

### B. 数据说明

- 数据文件：`sh601668.csv`
- 数据来源：邢不行整理
- 数据范围：2009-07-29 至 2025-01-21
- 数据频率：日线（重采样为月线）
- 数据条数：3,756条日线 → 187条月线

### C. 技术指标说明

- **MACD(12,26,9)**：趋势跟踪指标
- **MA60**：5年均线（60个月）
- **MA120**：10年均线（120个月）
- **RSI(14)**：相对强弱指标
- **成交量均值**：3个月移动平均

---

**报告生成时间**：2025年1月  
**策略版本**：v1.0（优化版）  
**回测周期**：2009年7月 - 2025年1月（15.5年）

**免责声明**：本报告仅供学习研究使用，不构成投资建议。历史回测结果不代表未来表现，投资有风险，入市需谨慎。
